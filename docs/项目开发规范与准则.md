# TG Empire 项目开发规范与准则

## 📋 概述

本文档定义了TG Empire项目的开发规范、架构准则和质量标准，确保项目按照既定的技术路线和最佳实践进行开发。

## 🏗️ 架构准则 (Architecture Rules)

### AR-001: 单一技术栈原则
**规则**: 前端必须统一使用Vue 3 + Vite技术栈
- ✅ **允许**: Vue 3组件、Vite构建、TypeScript/JavaScript
- ❌ **禁止**: 静态HTML页面、jQuery、其他框架混用
- **违规处理**: 立即移除非Vue实现，重构为Vue组件

### AR-002: Mini App架构原则
**规则**: 所有前端应用必须基于Telegram Mini App架构
- ✅ **允许**: 使用@twa-dev/sdk、Telegram WebApp API
- ❌ **禁止**: 传统Web页面、非Mini App实现
- **目录结构**: `frontend/src/apps/{AppName}/{AppName}.vue`

### AR-003: API设计原则
**规则**: 后端API必须遵循RESTful设计规范
- ✅ **允许**: `/api/v1/` 前缀、标准HTTP方法、JSON格式
- ❌ **禁止**: 非标准路由、混合数据格式
- **版本控制**: 使用URL版本控制 (`/api/v1/`, `/api/v2/`)

### AR-004: 数据库设计原则
**规则**: 数据库设计必须符合第三范式
- ✅ **允许**: PostgreSQL主库、Redis缓存、标准化设计
- ❌ **禁止**: 数据冗余、非标准化设计
- **命名规范**: 表名小写下划线、字段名小写下划线

## 🔧 开发规范 (Development Standards)

### DS-001: 代码组织规范
```
backend/
├── src/
│   ├── controllers/     # 控制器层
│   ├── services/        # 业务逻辑层
│   ├── models/          # 数据模型层
│   ├── routes/          # 路由定义
│   ├── middleware/      # 中间件
│   ├── utils/           # 工具函数
│   └── config/          # 配置文件

frontend/
├── src/
│   ├── apps/            # Mini App应用
│   │   └── {AppName}/   # 具体应用目录
│   ├── components/      # 共享组件
│   ├── utils/           # 工具函数
│   └── assets/          # 静态资源
```

### DS-002: 命名规范
- **文件名**: PascalCase for components, camelCase for utilities
- **变量名**: camelCase
- **常量名**: UPPER_SNAKE_CASE
- **API路由**: kebab-case
- **数据库**: snake_case

### DS-003: 代码质量标准
- **函数长度**: 不超过50行
- **文件长度**: 不超过500行
- **圈复杂度**: 不超过10
- **测试覆盖率**: 不低于80%

## 🚫 禁止事项 (Forbidden Practices)

### FP-001: 技术栈混用
❌ **严格禁止**:
- 在Vue项目中使用静态HTML页面
- 混用多个前端框架
- 绕过既定的技术架构

### FP-002: 硬编码配置
❌ **严格禁止**:
- API地址硬编码
- 数据库连接信息硬编码
- 环境相关配置硬编码

### FP-003: 直接数据库操作
❌ **严格禁止**:
- 在控制器中直接操作数据库
- 跳过服务层的业务逻辑
- SQL注入风险的查询

### FP-004: 未经授权的依赖
❌ **严格禁止**:
- 添加未经评估的第三方库
- 使用有安全风险的依赖
- 引入与项目架构不符的库

## ✅ 必须遵循 (Mandatory Requirements)

### MR-001: 文档先行
- 新功能开发前必须先更新PRD/TDD文档
- API变更必须先更新API文档
- 架构变更必须先更新架构文档

### MR-002: 测试驱动
- 新功能必须包含单元测试
- API接口必须包含集成测试
- 关键业务逻辑必须包含端到端测试

### MR-003: 代码审查
- 所有代码变更必须经过Code Review
- 不允许直接推送到主分支
- 必须通过CI/CD检查

### MR-004: 错误处理
- 所有API必须包含完整的错误处理
- 前端必须处理所有可能的错误状态
- 错误信息必须用户友好

## 🔍 质量检查清单 (Quality Checklist)

### 代码提交前检查
- [ ] 代码符合项目命名规范
- [ ] 没有硬编码配置
- [ ] 包含必要的错误处理
- [ ] 添加了相应的测试
- [ ] 通过了代码质量检查
- [ ] 更新了相关文档

### 功能发布前检查
- [ ] 功能完整实现PRD要求
- [ ] 通过了所有测试用例
- [ ] 性能满足要求
- [ ] 安全性检查通过
- [ ] 用户体验符合设计
- [ ] 文档已更新

## 🛠️ 工具和流程 (Tools & Processes)

### 开发工具
- **代码编辑器**: VS Code / Cursor (推荐)
- **版本控制**: Git
- **包管理**: npm
- **构建工具**: Vite (前端), Node.js (后端)
- **容器化**: Docker + Docker Compose

### 代码质量工具
- **Linting**: ESLint
- **格式化**: Prettier
- **测试**: Jest (后端), Vitest (前端)
- **类型检查**: TypeScript (可选)

### CI/CD流程
1. **代码提交** → 自动触发CI
2. **代码检查** → Lint + 格式检查
3. **单元测试** → 运行所有测试
4. **构建验证** → 确保可以正常构建
5. **部署准备** → 生成部署包

## 📊 监控和度量 (Monitoring & Metrics)

### 代码质量度量
- **代码覆盖率**: ≥ 80%
- **代码重复率**: ≤ 5%
- **技术债务**: 定期评估和清理
- **依赖安全**: 定期扫描和更新

### 性能度量
- **API响应时间**: ≤ 500ms
- **页面加载时间**: ≤ 3s
- **数据库查询**: ≤ 100ms
- **内存使用**: 监控和优化

## 🚨 违规处理 (Violation Handling)

### 轻微违规 (Warning)
- 命名不规范
- 注释不完整
- 代码格式问题
**处理**: 要求修改，代码审查不通过

### 严重违规 (Error)
- 架构原则违反
- 安全风险代码
- 硬编码配置
**处理**: 立即回滚，重新开发

### 重大违规 (Critical)
- 数据安全风险
- 系统架构破坏
- 恶意代码
**处理**: 紧急修复，事故分析

## 📚 参考文档

- [MVP开发指南](./MVP_开发指南.md)
- [安装与配置指南](./安装与配置指南.md)
- [Context7使用指南](./Context7_使用指南.md)
- [项目说明](./项目说明.md)

## 🔄 文档更新

本文档会根据项目发展和最佳实践的演进定期更新。所有团队成员都有责任遵循这些规范，并在发现问题时及时反馈。

---

**版本**: 1.0  
**最后更新**: 2025-07-08  
**下次审查**: 2025-08-08
